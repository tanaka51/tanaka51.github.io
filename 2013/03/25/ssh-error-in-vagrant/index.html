
<!DOCTYPE html>
<html lang="ja">
<head>

  
  <meta charset="UTF-8">
  <title>
    vagrant で SSH authentication failed! とか出た場合の対処法 | status code 51
  </title>


  
  <meta name="viewport" content="width=device-width,user-scalable=no,maximum-scale=1,initial-scale=1">

  
  <link rel="canonical" href="http://blog.tanaka51.jp/2013/03/25/ssh-error-in-vagrant/"/>

  
  <link rel="stylesheet" href="/css/sanitize.css">
  <link rel="stylesheet" href="/css/responsive.css">
  <link rel="stylesheet" href="/css/highlight_monokai.css">
  <link rel="stylesheet" href="/css/theme.css">
  <link rel="stylesheet" href="/css/custom.css">
  
  
  <link href="http://blog.tanaka51.jpindex.xml" rel="alternate" type="application/rss+xml" title="status code 51" />
  <link href="http://blog.tanaka51.jpindex.xml" rel="feed" type="application/rss+xml" title="status code 51" />

  
  


</head>



<body>
<div class="container">

  
  <header role="banner">
    <div class="row gutters">
      <div id="site-title" class="col span_6">
        <h1><a href="http://blog.tanaka51.jp">status code 51</a></h1>
        
      </div>
      <div id="social" class="col span_6">
        <ul>
          <li><a href="https://twitter.com/tanaka51" target="_blank">Twitter</a></li>
          
          <li><a href="https://github.com/tanaka51" target="_blank">GitHub</a></li>
          <li><a href="http://blog.tanaka51.jp/index.xml" type="application/rss+xml" target="_blank">RSS</a></li>
        </ul>
      </div>
    </div>
  </header>


  
  <main id="single" role="main">
    <div class="article-header">
  <h1><a href="http://blog.tanaka51.jp/2013/03/25/ssh-error-in-vagrant/">vagrant で SSH authentication failed! とか出た場合の対処法 </a></h1>
  <div class="meta">
    Mar 25, 2013 &nbsp;
    
  </div>
</div>


    <article>
      

<p>vagrant で</p>

<pre><code>$ vagrant halt
[default] Attempting graceful shutdown of VM...
SSH authentication failed! This is typically caused by the public/private
keypair for the SSH user not being properly set on the guest VM. Please
verify that the guest VM is setup with the proper public key, and that
the private key path for Vagrant is setup properly as well.
</code></pre>

<p>こんなエラーが出た時の対処方。</p>

<p>環境は</p>

<ul>
<li>ホスト: Mac (OSX 10.8.3)</li>
<li>ゲスト: Ubuntu 10.04.4 LTS</li>
</ul>

<h2 id="やりたいこと:f2845af5bd510c062181f433324bf9d4">やりたいこと</h2>

<ul>
<li>vagrant up で起動した VM に ssh を使った password-less ログインしたい</li>
<li>vagrant halt に成功したい</li>
</ul>

<h2 id="やっていたこと:f2845af5bd510c062181f433324bf9d4">やっていたこと</h2>

<ul>
<li>ゲスト側の <code>~/.ssh/authorized_keys</code> にホスト側の公開鍵を書いておく</li>
<li>ゲスト側の <code>~/.ssh/authorized_keys</code> の権限を 600 にしておく</li>
<li>ホスト側の <code>~/.vagrant.d/insecure_private_key</code> の権限が (user):staff になっている事を確認</li>
</ul>

<h2 id="解決の仕方:f2845af5bd510c062181f433324bf9d4">解決の仕方</h2>

<p>以下を参考</p>

<p><a href="http://superuser.com/questions/428917/ssh-basics-on-vagrant-vms" title="virtualbox - SSH Basics on Vagrant VMs - Super User">virtualbox - SSH Basics on Vagrant VMs - Super User</a></p>

<p>ホスト側の <code>~/.vagrant.d/boxes/&lt;yourbox&gt;/include/Vagrantfile</code> に、秘密鍵のパスを設定する必要があるらしい。</p>

<p>その部分はこんな感じに書いた。</p>

<pre><code class="language-rb">Vagrant::Config.run do |config|
  # This Vagrantfile is auto-generated by `vagrant package` to contain
  # the MAC address of the box. Custom configuration should be placed in
  # the actual `Vagrantfile` in this box.
  config.vm.base_mac = &quot;XXXXXXXXXXXX&quot;
  config.ssh.private_key_path = &quot;~/.ssh/id_rsa&quot; # ここを追加
end
</code></pre>

<p>念のためホスト側の <code>~/.ssh/id_rsa.pub</code> をゲスト側の <code>~/.ssh/authorized_keys</code> にコピーしなおしたら、password-less ログインも vagrant halt もうまくいった。</p>

<p>めでたしめでたし。</p>

      
      
      
    </article>
    


  </main>
  
  <nav class="pagination-single">
    
      <span class="previous">&larr; <a href="http://blog.tanaka51.jp/2013/03/23/use-octomacs/" rel="prev">Octomacs を rvm で使う、もしくは Emacs Lisp のデバッグ方法、Emacs Lisp の勉強になったという話</a></span>
    
    
      <span class="next"><a href="http://blog.tanaka51.jp/2013/03/25/use-emacs-with-tmux/" rel="next">Emacs と Tmux</a> &rarr;</span>
    
  </nav>


  
  <footer role="contentinfo">
    <div style="text-align:center;">
      
      &copy; Koichi Tanaka
    </div>
  </footer>


</div>

<script src="/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<script>
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-38154427-1', 'auto');
	ga('send', 'pageview');
</script>

</body>
</html>


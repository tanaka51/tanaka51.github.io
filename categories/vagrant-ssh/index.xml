<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Vagrant Ssh on status code 51</title>
    <link>http://blog.tanaka51.jp/categories/vagrant-ssh/</link>
    <description>Recent content in Vagrant Ssh on status code 51</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>ja</language>
    <lastBuildDate>Mon, 25 Mar 2013 17:28:00 +0000</lastBuildDate>
    <atom:link href="http://blog.tanaka51.jp/categories/vagrant-ssh/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>vagrant で SSH authentication failed! とか出た場合の対処法</title>
      <link>http://blog.tanaka51.jp/2013/03/25/vagrant-%E3%81%A7-ssh-authentication-failed-%E3%81%A8%E3%81%8B%E5%87%BA%E3%81%9F%E5%A0%B4%E5%90%88%E3%81%AE%E5%AF%BE%E5%87%A6%E6%B3%95/</link>
      <pubDate>Mon, 25 Mar 2013 17:28:00 +0000</pubDate>
      
      <guid>http://blog.tanaka51.jp/2013/03/25/vagrant-%E3%81%A7-ssh-authentication-failed-%E3%81%A8%E3%81%8B%E5%87%BA%E3%81%9F%E5%A0%B4%E5%90%88%E3%81%AE%E5%AF%BE%E5%87%A6%E6%B3%95/</guid>
      <description>

&lt;p&gt;vagrant で&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ vagrant halt
[default] Attempting graceful shutdown of VM...
SSH authentication failed! This is typically caused by the public/private
keypair for the SSH user not being properly set on the guest VM. Please
verify that the guest VM is setup with the proper public key, and that
the private key path for Vagrant is setup properly as well.
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;こんなエラーが出た時の対処方。&lt;/p&gt;

&lt;p&gt;環境は&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;ホスト: Mac (OSX 10.8.3)&lt;/li&gt;
&lt;li&gt;ゲスト: Ubuntu 10.04.4 LTS&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;やりたいこと:b598d2fcf0295f420ba3aa72ca7cfb64&#34;&gt;やりたいこと&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;vagrant up で起動した VM に ssh を使った password-less ログインしたい&lt;/li&gt;
&lt;li&gt;vagrant halt に成功したい&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;やっていたこと:b598d2fcf0295f420ba3aa72ca7cfb64&#34;&gt;やっていたこと&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;ゲスト側の &lt;code&gt;~/.ssh/authorized_keys&lt;/code&gt; にホスト側の公開鍵を書いておく&lt;/li&gt;
&lt;li&gt;ゲスト側の &lt;code&gt;~/.ssh/authorized_keys&lt;/code&gt; の権限を 600 にしておく&lt;/li&gt;
&lt;li&gt;ホスト側の &lt;code&gt;~/.vagrant.d/insecure_private_key&lt;/code&gt; の権限が (user):staff になっている事を確認&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;解決の仕方:b598d2fcf0295f420ba3aa72ca7cfb64&#34;&gt;解決の仕方&lt;/h2&gt;

&lt;p&gt;以下を参考&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://superuser.com/questions/428917/ssh-basics-on-vagrant-vms&#34; title=&#34;virtualbox - SSH Basics on Vagrant VMs - Super User&#34;&gt;virtualbox - SSH Basics on Vagrant VMs - Super User&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;ホスト側の &lt;code&gt;~/.vagrant.d/boxes/&amp;lt;yourbox&amp;gt;/include/Vagrantfile&lt;/code&gt; に、秘密鍵のパスを設定する必要があるらしい。&lt;/p&gt;

&lt;p&gt;その部分はこんな感じに書いた。&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-rb&#34;&gt;Vagrant::Config.run do |config|
  # This Vagrantfile is auto-generated by `vagrant package` to contain
  # the MAC address of the box. Custom configuration should be placed in
  # the actual `Vagrantfile` in this box.
  config.vm.base_mac = &amp;quot;XXXXXXXXXXXX&amp;quot;
  config.ssh.private_key_path = &amp;quot;~/.ssh/id_rsa&amp;quot; # ここを追加
end
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;念のためホスト側の &lt;code&gt;~/.ssh/id_rsa.pub&lt;/code&gt; をゲスト側の &lt;code&gt;~/.ssh/authorized_keys&lt;/code&gt; にコピーしなおしたら、password-less ログインも vagrant halt もうまくいった。&lt;/p&gt;

&lt;p&gt;めでたしめでたし。&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>